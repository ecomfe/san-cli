<!doctype html><html><head><meta charset="utf-8"/><title>San CLI</title><link rel="icon" href="/san-cli/favicon.ico"><script>window['SAN_DOCIT'] = {};</script><base href="/san-cli/"><link href="/san-cli/static/css/chunk-vendors.css" rel="stylesheet"><link href="/san-cli/static/css/client-entry.css" rel="stylesheet"></head><body><div id="app"><div id="site"><header id="header"><a href="/san-cli/" class="navbar"><img src="/san-cli/logo.svg" alt="Home" class="logo"> <span>San CLI</span></a><ul><li><a target="_blank" href="https://baidu.github.io/san/">San</a></li><li><a target="_blank" href="https://ecomfe.github.io/santd/">Santd</a></li><li><a target="_blank" href="https://github.com/ecomfe/eslint-plugin-san">Github</a></li></ul></header><aside id="sidebar" class="sidebar"><ul class="tree"><li data-id="/"><a href="/san-cli/" onclick="return false;">介绍</a></li><li><span>基础命令</span><ul><li data-id="/create-project/"><a href="/san-cli/create-project/" onclick="return false;">初始化项目</a></li><li data-id="/serve/"><a href="/san-cli/serve/" onclick="return false;">开发打包</a></li><li data-id="/build/"><a href="/san-cli/build/" onclick="return false;">生产打包</a></li></ul></li><li><span>配置</span><ul><li data-id="/config/"><a href="/san-cli/config/" onclick="return false;">San CLI 配置文件</a></li><li data-id="/advanced/"><a href="/san-cli/advanced/" onclick="return false;">高级配置</a></li><li data-id="/presets/"><a href="/san-cli/presets/" onclick="return false;">Presets 预设</a></li><li data-id="/env/"><a href="/san-cli/env/" onclick="return false;">环境变量</a></li></ul></li><li><span>常见解决方案</span><ul><li data-id="/modern-mode/"><a href="/san-cli/modern-mode/" onclick="return false;">现在的浏览器打包模式</a></li><li data-id="/bundle-analyze/"><a href="/san-cli/bundle-analyze/" onclick="return false;">Bundle 分析</a></li><li data-id="/component/"><a href="/san-cli/component/" onclick="return false;">San Component 组件开发</a></li><li data-id="/smarty/"><a href="/san-cli/smarty/" onclick="return false;">Smarty 相关</a></li><li data-id="/deployment/"><a href="/san-cli/deployment/" onclick="return false;">部署</a></li><li data-id="/hulk-cli-migration/"><a href="/san-cli/hulk-cli-migration/" onclick="return false;">hulk-cli升级san-cli</a></li></ul></li><li><span>二次开发</span><ul><li data-id="/architecture/"><a href="/san-cli/architecture/" onclick="return false;">内部实现</a></li><li data-id="/create-scaffold/"><a href="/san-cli/create-scaffold/" onclick="return false;">如何创建一个脚手架项目</a></li><li data-id="/plugin/"><a href="/san-cli/plugin/" onclick="return false;">插件</a><ul><li data-id="/cmd-plugin/"><a href="/san-cli/cmd-plugin/" onclick="return false;">Command 插件</a></li><li data-id="/srv-plugin/"><a href="/san-cli/srv-plugin/" onclick="return false;">编写一个 Serivce 插件</a></li></ul></li></ul></li><li><span>CLI UI</span><ul><li data-id="/ui/start/"><a href="/san-cli/ui/start/" onclick="return false;">San CLI UI</a></li><li><span>功能简介</span><ul><li data-id="/ui/project-list/"><a href="/san-cli/ui/project-list/" onclick="return false;">项目管理</a></li><li data-id="/ui/dashboard/"><a href="/san-cli/ui/dashboard/" onclick="return false;">工具扩展</a></li><li data-id="/ui/plugin/"><a href="/san-cli/ui/plugin/" onclick="return false;">插件管理</a></li><li data-id="/ui/dependency/"><a href="/san-cli/ui/dependency/" onclick="return false;">依赖管理与插件管理</a></li><li data-id="/ui/configuration/"><a href="/san-cli/ui/configuration/" onclick="return false;">配置管理</a></li><li data-id="/ui/task/"><a href="/san-cli/ui/task/" onclick="return false;">任务管理</a></li></ul></li><li><span>插件开发</span><ul><li data-id="/ui/structure/"><a href="/san-cli/ui/structure/" onclick="return false;">San CLI UI 工作流程</a></li><li data-id="/ui/plugin-object/"><a href="/san-cli/ui/plugin-object/" onclick="return false;">插件对象</a></li><li data-id="/ui/add-addon/"><a href="/san-cli/ui/add-addon/" onclick="return false;">widget部件</a></li><li data-id="/ui/add-config/"><a href="/san-cli/ui/add-config/" onclick="return false;">添加项目配置</a></li><li data-id="/ui/cover-task/"><a href="/san-cli/ui/cover-task/" onclick="return false;">更改项目任务</a></li><li data-id="/ui/add-view/"><a href="/san-cli/ui/add-view/" onclick="return false;">添加自定义视图</a></li><li data-id="/ui/static/"><a href="/san-cli/ui/static/" onclick="return false;">公共静态文件</a></li></ul></li></ul></li></ul></aside><article id="content"><div id="router-view" class="router-view"><div class="content"><div class="markdown"><h1 id="%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE"><a class="header-anchor" href="#%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE">#</a> 高级配置</h1><p>这篇文章介绍一些高级配置的配置项，这些配置项虽然在日常项目中配置的较少，但是对于项目来说这些配置项往往是可以解决日常常见的问题。</p><h2 id="%E4%BD%BF%E7%94%A8%E6%8B%86%E5%8C%85"><a class="header-anchor" href="#%E4%BD%BF%E7%94%A8%E6%8B%86%E5%8C%85">#</a> 使用拆包</h2><p>在项目中，不合理的 Bundle 是致命的。在 Webpack 中，总共提供了三种方式来实现代码拆分（Code Splitting）：</p><ul><li>entry 配置：通过多个 entry 文件来实现；</li><li>动态加载（按需加载）：通过写代码时主动使用<code>import()</code>或者<code>require.ensure</code>来动态加载；</li><li>抽取公共代码：使用<code>splitChunks</code>配置来抽取公共代码。</li></ul><p>在 San CLI 中可以通过<code>splitChunks</code>抽取公共代码。<code>splitChunks</code>的配置项跟 Webpack 中 <code>optimization</code>的<code>splitChunks</code>是完全相同的。例如下面的配置：</p><pre class="language-js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
        cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
            vendors<span class="token operator">:</span> <span class="token punctuation">{</span>
                name<span class="token operator">:</span> <span class="token string">&#39;vendors&#39;</span><span class="token punctuation">,</span>
                test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules(?!\/@baidu)[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                <span class="token comment">// minChunks: 1,</span>
                priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            common<span class="token operator">:</span> <span class="token punctuation">{</span>
                name<span class="token operator">:</span> <span class="token string">&#39;common&#39;</span><span class="token punctuation">,</span>
                test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">([\/]src\/components(-open)?|[\\/]node_modules\/@baidu\/nano)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
                minChunks<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                chunks<span class="token operator">:</span> <span class="token string">&#39;initial&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><blockquote><p>同时 San CLI 内置了 <a href="https://github.com/NMFR/optimize-css-assets-webpack-plugin" target="_blank">optimize-css-assets-webpack-plugin</a>，也就是说支持使用 splitChunks 来拆分 CSS 文件。</p></blockquote><h2 id="%E4%BB%A3%E7%A0%81%E5%8E%8B%E7%BC%A9%E5%92%8C%E4%BC%98%E5%8C%96"><a class="header-anchor" href="#%E4%BB%A3%E7%A0%81%E5%8E%8B%E7%BC%A9%E5%92%8C%E4%BC%98%E5%8C%96">#</a> 代码压缩和优化</h2><p>在项目中可以对产出的代码中压缩和优化，在 San CLI 的 JS 使用了 terserjs 和 CSS 使用 cssnano。支持默认 San CLI 的配置是：</p><p>默认 cssnano 配置：</p><pre class="language-js"><code class="language-js"><span class="token punctuation">{</span>
    mergeLonghand<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    cssDeclarationSorter<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    normalizeUrl<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    discardUnused<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token comment">// 避免 cssnano 重新计算 z-index</span>
    zindex<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    reduceIdents<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    safe<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// cssnano 集成了autoprefixer的功能</span>
    <span class="token comment">// 会使用到autoprefixer进行无关前缀的清理</span>
    <span class="token comment">// 关闭autoprefixer功能</span>
    <span class="token comment">// 使用postcss的autoprefixer功能</span>
    autoprefixer<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    discardComments<span class="token operator">:</span> <span class="token punctuation">{</span>
        removeAll<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>在 San CLI 的配置文件中，所有跟 CSS 的相关的配置是放在了<code>css</code>配置项中，所以对 cssnano 的修改也是在<code>css.cssnanoOptions</code>中进行修改：</p><pre class="language-js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    css<span class="token operator">:</span> <span class="token punctuation">{</span>
        cssnanoOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// 自定义的配置</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>默认 terserjs 配置：</p><pre class="language-js"><code class="language-js"><span class="token punctuation">{</span>
    comments<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    compress<span class="token operator">:</span> <span class="token punctuation">{</span>
        unused<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// 删掉 debugger</span>
        drop_debugger<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// eslint-disable-line</span>
        <span class="token comment">// 移除 console</span>
        drop_console<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// eslint-disable-line</span>
        <span class="token comment">// 移除无用的代码</span>
        dead_code<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// eslint-disable-line</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    ie8<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    safari10<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    warnings<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    toplevel<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span></code></pre><p>San CLI 的配置文件中使用<code>terserOptions</code>可以对默认的配置进行修改：</p><pre class="language-js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    terserOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 自定义的配置</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h3 id="html-minifier-%E9%85%8D%E7%BD%AE"><a class="header-anchor" href="#html-minifier-%E9%85%8D%E7%BD%AE">#</a> html-minifier 配置</h3><p>除此之外，San CLI 中使用的 html-webpack-plugin 的配置项中可以使用 html-minifier，在 San CLi 中默认的配置如下：</p><pre class="language-js"><code class="language-js"><span class="token punctuation">{</span>
    removeComments<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    collapseWhitespace<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    removeAttributeQuotes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    collapseBooleanAttributes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    removeScriptTypeAttributes<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    minifyCSS<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// more options:</span>
    <span class="token comment">// https://github.com/kangax/html-minifier#options-quick-reference</span>
<span class="token punctuation">}</span></code></pre><p>使用者可以在<code>pages</code>中的<code>html-minifier</code>进行配置，具体配置可以<a href="https://github.com/DanielRuf/html-minifier-terser#options-quick-reference" target="_blank">参考这里</a>。</p><h2 id="%E7%BC%96%E8%AF%91-npm-%E5%8C%85%E4%B8%AD%E7%9A%84-es6-%E8%AF%AD%E6%B3%95"><a class="header-anchor" href="#%E7%BC%96%E8%AF%91-npm-%E5%8C%85%E4%B8%AD%E7%9A%84-es6-%E8%AF%AD%E6%B3%95">#</a> 编译 NPM 包中的 ES6 语法</h2><p>在项目中，我们推荐使用 ESM 语法的模块，ESM 语法的模块在使用的同时，可以使用统一 的 Webpack 配置，并且基于 Tree-shaking，打出的包体积更加合理。但是在 San CLI 中，默认是不会编译 NPM 包中的 ES6 语法的代码，这时候依赖的 NPM 包中使用 ES6 语法，需要使用<code>transpileDependencies</code>。</p><p><code>transpileDependencies</code>可接受的类型为<code>Array</code>、<code>String</code>或者<code>RegExp</code>。例如我们项目依赖<code>@baidu/nano</code>这个 UI 基础库，则可以设置配置如下：</p><pre class="language-js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    transpileDependencies<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;@baidu/nano&#39;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>这样<code>nano</code>这个模块就会被 Webpack 编译了。</p><h2 id="%E4%BD%BF%E7%94%A8-chainwebpack-%E5%92%8C-configwebpack-%E8%BF%9B%E8%A1%8C%E4%B8%AA%E6%80%A7%E5%8C%96%E9%85%8D%E7%BD%AE"><a class="header-anchor" href="#%E4%BD%BF%E7%94%A8-chainwebpack-%E5%92%8C-configwebpack-%E8%BF%9B%E8%A1%8C%E4%B8%AA%E6%80%A7%E5%8C%96%E9%85%8D%E7%BD%AE">#</a> 使用 chainWebpack 和 configWebpack 进行个性化配置</h2><p>如果要更加自主的进行个性化的配置，那么可以在 San CLI 配置文件中的 chainWebpack 和 configWebpack 进行修改，<code>chainWebpack</code> 接受的参数是 <a href="https://github.com/neutrinojs/webpack-chain" target="_blank">webpack-chain</a> 语法的配置，<code>configWebpack</code>接受的参数是 Webpack 的配置对象。</p><p>例如：</p><pre class="language-js"><code class="language-js"><span class="token comment">// 静态文件域名</span>
<span class="token keyword">const</span> <span class="token constant">CDN</span> <span class="token operator">=</span> <span class="token string">&#39;https://s.bdstatic.com/&#39;</span><span class="token punctuation">;</span>
<span class="token comment">// 生产环境下的静态目录</span>
<span class="token keyword">const</span> <span class="token constant">STATIC_PRO</span> <span class="token operator">=</span> <span class="token string">&#39;static/pro&#39;</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">chainWebpack</span><span class="token operator">:</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 这里可以用来扩展 webpack 的配置，使用的是 webpack-chain 语法</span>
        config<span class="token punctuation">.</span>module
            <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif)(\?.*)?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&#39;url-loader&#39;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span>require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;url-loader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                limit<span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
                name<span class="token operator">:</span> <span class="token constant">STATIC_PRO</span> <span class="token operator">+</span> <span class="token string">&#39;/img/[name].[hash:7].[ext]&#39;</span><span class="token punctuation">,</span>
                publicPath<span class="token operator">:</span> __isProduction <span class="token operator">?</span> <span class="token constant">CDN</span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        config<span class="token punctuation">.</span>module
            <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">&#39;svg&#39;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&#39;svg-url-loader&#39;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span>require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;svg-url-loader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                limit<span class="token operator">:</span> <span class="token number">2500</span><span class="token punctuation">,</span>
                name<span class="token operator">:</span> <span class="token constant">STATIC_PRO</span> <span class="token operator">+</span> <span class="token string">&#39;/svg/[name].[hash:7].[ext]&#39;</span><span class="token punctuation">,</span>
                publicPath<span class="token operator">:</span> __isProduction <span class="token operator">?</span> <span class="token constant">CDN</span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h2 id="%E5%9C%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E6%B7%BB%E5%8A%A0-service-%E6%8F%92%E4%BB%B6"><a class="header-anchor" href="#%E5%9C%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E6%B7%BB%E5%8A%A0-service-%E6%8F%92%E4%BB%B6">#</a> 在配置文件中添加 Service 插件</h2><p><code>plugins</code> 增加自定义插件，例如：</p><pre class="language-js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            id<span class="token operator">:</span> <span class="token string">&#39;built-in:plugin-progress&#39;</span><span class="token punctuation">,</span>
            <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">api<span class="token punctuation">,</span> projectOptions<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                api<span class="token punctuation">.</span><span class="token function">chainWebpack</span><span class="token punctuation">(</span><span class="token parameter">webpackConfig</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    options<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;san-cli-utils/randomColor&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>color<span class="token punctuation">;</span>
                    webpackConfig<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">&#39;progress&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpackbar&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&#39;san-plugin.js&#39;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h2 id="%E6%B7%BB%E5%8A%A0-dev-server-%E4%B8%AD%E9%97%B4%E4%BB%B6"><a class="header-anchor" href="#%E6%B7%BB%E5%8A%A0-dev-server-%E4%B8%AD%E9%97%B4%E4%BB%B6">#</a> 添加 dev server 中间件</h2><p>添加 dev server 中间件，需要使用 Service 的插件的<code>addDevServerMiddleware</code>方法，例如：</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        id<span class="token operator">:</span> <span class="token string">&#39;middleware1&#39;</span><span class="token punctuation">,</span>
        <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">api</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 使用 api 配置dev server 中间件</span>
            api<span class="token punctuation">.</span><span class="token function">middleware</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;hulk-mock-server&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token comment">// 配置contentBase</span>
                    contentBase<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./&#39;</span> <span class="token operator">+</span> outputDir <span class="token operator">+</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token comment">// 配置 mock 路径</span>
                    rootDir<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./mock&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token comment">// 配置解析器相关内容</span>
                    processors<span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">smarty?router=/template/*&amp;baseDir=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>
                            __dirname<span class="token punctuation">,</span>
                            <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>outputDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/template</span><span class="token template-punctuation string">`</span></span>
                        <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;dataDir=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./mock/_data_&#39;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
                    <span class="token punctuation">]</span> <span class="token comment">// eslint-disable-line</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    plugins
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><div class="warning"><p>这里特殊说明下，<code>middleware</code>传入的是一个 function，并且<strong>返回</strong>一个中间件。</p></div><h2 id="%E6%9B%B4%E5%A4%9A"><a class="header-anchor" href="#%E6%9B%B4%E5%A4%9A">#</a> 更多</h2><p>如果想了解更多 Service 插件相关内容，那么请浏览<a href="/san-cli/srv-plugin/">这个文档</a></p></div></div></div><aside class="toc"><ul class="tree"></ul></aside></article></div></div><script src="/san-cli/static/js/chunk-vendors.js"></script><script src="/san-cli/static/js/client-entry.js"></script></body></html>